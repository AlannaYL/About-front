import{Q as H}from"./QChip.67d223a0.js";import{u as K,c as X,d as Y,f as Z,e as G,g as J,h as E}from"./use-key-composition.b7664e18.js";import{r as z,c as f,g as Q,aj as ee,aa as $,a3 as te,h as g,A as L,Z as ie,af as le,w as ne,k as ae,a4 as ue,C as re,ah as oe}from"./index.ce5bf077.js";import{u as se}from"./QForm.77ae0701.js";import{h as ce}from"./format.3e32b8d9.js";function V(e,c,y,x){const o=[];return e.forEach(a=>{x(a)===!0?o.push(a):c.push({failedPropValidation:y,file:a})}),o}function A(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),$(e)}const fe={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},de=["rejected"];function ge({editable:e,dnd:c,getFileInput:y,addFilesToQueue:x}){const{props:o,emit:a,proxy:b}=Q(),d=z(null),h=f(()=>o.accept!==void 0?o.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),F=f(()=>parseInt(o.maxFiles,10)),C=f(()=>parseInt(o.maxTotalSize,10));function k(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&ee(t);else{const m=y();m&&m!==t.target&&m.click(t)}}function q(t){e.value&&t&&x(null,t)}function I(t,m,N,j){let n=Array.from(m||t.target.files);const v=[],i=()=>{v.length>0&&a("rejected",v)};if(o.accept!==void 0&&h.value.indexOf("*/")===-1&&(n=V(n,v,"accept",u=>h.value.some(s=>u.type.toUpperCase().startsWith(s)||u.name.toUpperCase().endsWith(s))),n.length===0))return i();if(o.maxFileSize!==void 0){const u=parseInt(o.maxFileSize,10);if(n=V(n,v,"max-file-size",s=>s.size<=u),n.length===0)return i()}if(o.multiple!==!0&&n.length>0&&(n=[n[0]]),n.forEach(u=>{u.__key=u.webkitRelativePath+u.lastModified+u.name+u.size}),j===!0){const u=N.map(s=>s.__key);n=V(n,v,"duplicate",s=>u.includes(s.__key)===!1)}if(n.length===0)return i();if(o.maxTotalSize!==void 0){let u=j===!0?N.reduce((s,D)=>s+D.size,0):0;if(n=V(n,v,"max-total-size",s=>(u+=s.size,u<=C.value)),n.length===0)return i()}if(typeof o.filter=="function"){const u=o.filter(n);n=V(n,v,"filter",s=>u.includes(s))}if(o.maxFiles!==void 0){let u=j===!0?N.length:0;if(n=V(n,v,"max-files",()=>(u++,u<=F.value)),n.length===0)return i()}if(i(),n.length>0)return n}function P(t){A(t),c.value!==!0&&(c.value=!0)}function r(t){$(t),(t.relatedTarget!==null||te.is.safari!==!0?t.relatedTarget!==d.value:document.elementsFromPoint(t.clientX,t.clientY).includes(d.value)===!1)===!0&&(c.value=!1)}function p(t){A(t);const m=t.dataTransfer.files;m.length>0&&x(null,m),c.value=!1}function T(t){if(c.value===!0)return g("div",{ref:d,class:`q-${t}__dnd absolute-full`,onDragenter:A,onDragover:A,onDragleave:r,onDrop:p})}return Object.assign(b,{pickFiles:k,addFiles:q}),{pickFiles:k,addFiles:q,onDragover:P,onDragleave:r,processFiles:I,getDndNode:T,maxFilesNumber:F,maxTotalSizeNumber:C}}var _e=L({name:"QFile",inheritAttrs:!1,props:{...K,...X,...fe,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Y,...de],setup(e,{slots:c,emit:y,attrs:x}){const{proxy:o}=Q(),a=Z(),b=z(null),d=z(!1),h=G(e),{pickFiles:F,onDragover:C,onDragleave:k,processFiles:q,getDndNode:I}=ge({editable:a.editable,dnd:d,getFileInput:R,addFilesToQueue:B}),P=se(e),r=f(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),p=f(()=>E(r.value)),T=f(()=>r.value.map(l=>l.name).join(", ")),t=f(()=>ce(r.value.reduce((l,S)=>l+S.size,0))),m=f(()=>({totalSize:t.value,filesNumber:r.value.length,maxFiles:e.maxFiles})),N=f(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:h.value,...x,id:a.targetUid.value,disabled:a.editable.value!==!0})),j=f(()=>"q-file q-field--auto-height"+(d.value===!0?" q-file--dnd":"")),n=f(()=>e.multiple===!0&&e.append===!0);function v(l){const S=r.value.slice();S.splice(l,1),u(S)}function i(l){const S=r.value.findIndex(l);S>-1&&v(S)}function u(l){y("update:modelValue",e.multiple===!0?l:l[0])}function s(l){l.keyCode===13&&le(l)}function D(l){(l.keyCode===13||l.keyCode===32)&&F(l)}function R(){return b.value}function B(l,S){const _=q(l,S,r.value,n.value),O=R();O!=null&&(O.value=""),_!==void 0&&((e.multiple===!0?e.modelValue&&_.every(W=>r.value.includes(W)):e.modelValue===_[0])||u(n.value===!0?r.value.concat(_):_))}function w(){return[g("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function U(){if(c.file!==void 0)return r.value.length===0?w():r.value.map((S,_)=>c.file({index:_,file:S,ref:this}));if(c.selected!==void 0)return r.value.length===0?w():c.selected({files:r.value,ref:this});if(e.useChips===!0)return r.value.length===0?w():r.value.map((S,_)=>g(H,{key:"file-"+_,removable:a.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{v(_)}},()=>g("span",{class:"ellipsis",textContent:S.name})));const l=e.displayValue!==void 0?e.displayValue:T.value;return l.length>0?[g("div",{class:e.inputClass,style:e.inputStyle,textContent:l})]:w()}function M(){const l={ref:b,...N.value,...P.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:B};return e.multiple===!0&&(l.multiple=!0),g("input",l)}return Object.assign(a,{fieldClass:j,emitValue:u,hasValue:p,inputRef:b,innerValue:r,floatingLabel:f(()=>p.value===!0||E(e.displayValue)),computedCounter:f(()=>{if(e.counterLabel!==void 0)return e.counterLabel(m.value);const l=e.maxFiles;return`${r.value.length}${l!==void 0?" / "+l:""} (${t.value})`}),getControlChild:()=>I("file"),getControl:()=>{const l={ref:a.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return a.editable.value===!0&&Object.assign(l,{onDragover:C,onDragleave:k,onKeydown:s,onKeyup:D}),g("div",l,[M()].concat(U()))}}),Object.assign(o,{removeAtIndex:v,removeFile:i,getNativeElement:()=>b.value}),ie(o,"nativeEl",()=>b.value),J(a)}});const me={ratio:[String,Number]};function ve(e,c){return f(()=>{const y=Number(e.ratio||(c!==void 0?c.value:void 0));return isNaN(y)!==!0&&y>0?{paddingBottom:`${100/y}%`}:null})}const he=16/9;var xe=L({name:"QImg",props:{...me,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:he},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:c,emit:y}){const x=z(e.initialRatio),o=ve(e,x);let a=null,b=!1;const d=[z(null),z(p())],h=z(0),F=z(!1),C=z(!1),k=f(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),q=f(()=>({width:e.width,height:e.height})),I=f(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),P=f(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));ne(()=>r(),T);function r(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function p(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function T(i){a!==null&&(clearTimeout(a),a=null),C.value=!1,i===null?(F.value=!1,d[h.value^1].value=p()):F.value=!0,d[h.value].value=i}function t({target:i}){b!==!0&&(a!==null&&(clearTimeout(a),a=null),x.value=i.naturalHeight===0?.5:i.naturalWidth/i.naturalHeight,m(i,1))}function m(i,u){b===!0||u===1e3||(i.complete===!0?N(i):a=setTimeout(()=>{a=null,m(i,u+1)},50))}function N(i){b!==!0&&(h.value=h.value^1,d[h.value].value=null,F.value=!1,C.value=!1,y("load",i.currentSrc||i.src))}function j(i){a!==null&&(clearTimeout(a),a=null),F.value=!1,C.value=!0,d[h.value].value=null,d[h.value^1].value=p(),y("error",i)}function n(i){const u=d[i].value,s={key:"img_"+i,class:I.value,style:P.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...u};return h.value===i?(s.class+=" q-img__image--waiting",Object.assign(s,{onLoad:t,onError:j})):s.class+=" q-img__image--loaded",g("div",{class:"q-img__container absolute-full",key:"img"+i},g("img",s))}function v(){return F.value!==!0?g("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},re(c[C.value===!0?"error":"default"])):g("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},c.loading!==void 0?c.loading():e.noSpinner===!0?void 0:[g(oe,{color:e.spinnerColor,size:e.spinnerSize})])}return T(r()),ae(()=>{b=!0,a!==null&&(clearTimeout(a),a=null)}),()=>{const i=[];return o.value!==null&&i.push(g("div",{key:"filler",style:o.value})),C.value!==!0&&(d[0].value!==null&&i.push(n(0)),d[1].value!==null&&i.push(n(1))),i.push(g(ue,{name:"q-transition--fade"},v)),g("div",{class:k.value,style:q.value,role:"img","aria-label":e.alt},i)}}});export{_e as Q,xe as a};
